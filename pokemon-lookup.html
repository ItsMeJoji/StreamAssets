<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Lookup</title>
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/fontawesome-free-6.7.2-web/css/all.min.css" />
    <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
</head>
<body class="is-preload">
    <div id="page-wrapper">
        <!-- Header -->
        <header id="header">
            <h1><a href="index.html">Stream Assets by ItsMeJoji</a></h1>
            <nav id="nav">
                <ul>
                    <li class="special">
                        <a href="#menu" class="menuToggle"><span>Menu</span></a>
                        <div id="menu">
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="friendship-checker.html">Friendship Tracker</a></li>
                                <li><a href="url-generator.html">URL Generator</a></li>
                                <li><a href="https://itsmejoji.github.io/ShinyPokemonBingoGenerator/" target="_blank">Shiny Bingo Generator</a></li>
                            </ul>
                            <div class="row-gtr-uniform">
                                <div class="col-6 col-12-xsmall">
                                    <a href="https://x.com/ItsMeJoji_" class="icon brands fa-twitter"><span class="label">Twitter</span></a>
                                </div>
                                <div class="col-6 col-12-xsmall">
                                    <a href="https://www.youtube.com/c/itsmejoji" class="icon brands fa-youtube"><span class="label">Youtube</span></a>
                                </div>
                                <div class="col-6 col-12-xsmall">
                                    <a href="patreon.com/ItsMeJoji" class="icon brands fa-patreon"><span class="label">Patreon</span></a>
                                </div>
                                <div class="col-6 col-12-xsmall">
                                    <a href="https://www.twitch.tv/itsmejoji/" class="icon brands fa-twitch"><span class="label">Twitch</span></a>
                                </div>
                                <div class="col-6 col-12-xsmall">
                                    <a href="https://www.tiktok.com/@itsmejoji_" class="icon brands fa-tiktok"><span class="label">TikTok</span></a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- Main -->
        <article id="main">
            <header>
                <h2>Pokemon Lookup</h2>
                <p>Find where a Pokemon can be found in various games!</p>
            </header>
            <section class="wrapper style5">
                <div class="inner">
                    <section>
                        <form>
                            <div class="row gtr-uniform">
                                <div class="col-12">
                                    <label for="pokemonName">Pokemon Name:</label>
                                    <input type="text" id="pokemonName" placeholder="Enter Pokemon Name" />
                                </div>
                                <div class="col-12">
                                    <ul class="actions">
                                        <li><input type="button" value="Lookup" class="primary" onclick="lookupPokemon()" /></li>
                                    </ul>
                                </div>
                                <div class="col-12">
                                    <div class="results" id="results">
                                        <!-- Results will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </form>
                    </section>
                </div>
            </section>
        </article>

        <!-- Footer -->
        <footer id="footer">
            <ul class="icons">
                <li><a href="https://bsky.app/profile/itsmejoji.com" class="fa-bluesky"><span class="label">BlueSky</span></a></li>
                <li><a href="https://www.youtube.com/c/itsmejoji" class=""><span class="label">Youtube</span></a></li>
                <li><a href="https://www.twitch.tv/itsmejoji/" class=""><span class="label">Twitch</span></a></li>
                <li><a href="https://www.tiktok.com/@itsmejoji_" class=""><span class="label">TikTok</span></a></li>
            </ul>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/pl.js"></script>
    <script src="assets/js/BitConverter.js"></script>

    <script>

        async function loadDAT(filePath){
            const response = await fetch(filePath);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const buffer = await response.arrayBuffer();
            const dat = new Uint8Array(buffer);
            const interval = 424;
            console.log('Map Count:', dat.length/interval);
            console.log('DAT:', dat);

            const percentGrass = [20, 20, 10, 10, 10, 10, 5, 5, 4, 4, 1, 1]
            const slotsRadar = [4, 5, 10, 11]
            const slotsRuby = [8,9]
            const names = await loadPokemonNames('./assets/dat/pokemon.txt');
            const areas = await loadAreaNames('./assets/dat/Maps_DP.txt');

            let mapInt
            let grass
            let pokeRadar
            let ruby

            for (i = 0; i < dat.length; i += interval) {
                const startsWithZero = dat[i] !== 0;
                mapInt = i/interval;
                console.log(`Interval starting at ${i}: ${startsWithZero ? 'Does not start with 0' : 'Start with 0'}`);

                if (startsWithZero) {
                    const location = areas[mapsTableDP.indexOf(mapInt)];
                    console.log(`Location: ${location}`);

                    grass = dat.slice(i+4, i+100);
                    console.log('Grass Slot Data:', grass);
                    console.log('Number of Grass Encounters: ', grass.length/8);
                    for (j = 0; j < grass.length; j += 8) {
                        const encounter = grass.slice(j, j+8);
                        const speciesID = BitConverter.toInt16(encounter.slice(4, 6));
                        const name = names[speciesID-1];
                        const maxLv = encounter[0];
                        let minLv = encounter[1];
                        if (minLv === 0) minLv = maxLv;
                        const percent = percentGrass[j/8];
                        console.log(`Pokemon: ${name}, Pokedex #: ${speciesID}, Min Level: ${minLv}, Max Level: ${maxLv}, Encounter Rate: ${percent}%`);;
                    }
                    pokeRadar = dat.slice(i+124, i+140);
                    console.log('Poke Radar Slot Data:', pokeRadar);
                    console.log('Encounter Changes when using Poke Radar: ', pokeRadar.length/4);
                    for (r = 0; r < pokeRadar.length; r += 4) {
                        const encounter = pokeRadar.slice(r, r+4);
                        const speciesID = BitConverter.toInt16(encounter.slice(0, r+4));
                        const name = names[speciesID-1];
                        console.log(`Pokemon: ${name}, Pokedex #: ${speciesID}`);;
                    }
                    ruby = dat.slice(i+164, i+172);
                    console.log('Ruby Slot Data:', ruby);
                    console.log('Encounter Changes when Ruby inserted: ', ruby.length/4);
                    for (r = 0; r < ruby.length; r += 4) {
                        const encounter = ruby.slice(r, r+4);
                        const speciesID = BitConverter.toInt16(encounter.slice(0, r+4));
                        //console.log(`Species ID: ${speciesID}`);
                        const name = names[speciesID-1];
                        console.log(`Pokemon: ${name}, Pokedex #: ${speciesID}`);;
                    }
                }
            }
            return dat;
        }



        mapsTableDP = [178, 176, 177, 53, 179, 180, 181, 182, 54, 55, 8, 9, 23, 24, 25, 26, 27, 28, 63, 69,
                    75, 112, 113, 114, 115, 118, 119, 121, 120, 122, 123, 124, 117, 0, 136, 137, 134, 7,
                    4, 5, 6, 56, 57, 58, 22, 19, 11, 12, 15, 16, 17, 18, 13, 10, 21, 20, 3, 138, 139, 140,
                    141, 142, 144, 143, 146, 145, 147, 148, 149, 150, 157, 156, 159, 158, 160, 161, 162, 163,
                    164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 47, 51, 48, 49, 50, 52, 29, 59,
                    106, 107, 108, 109, 110, 111, 151, 152, 153, 154, 155, 116, 2, 1, 125, 132];

        async function loadPokemonNames(filePath) {
            const response = await fetch(filePath);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const buffer = await response.arrayBuffer();
            return new TextDecoder().decode(buffer).split('\r\n');
        }

        async function loadAreaNames(filePath) {
            const response = await fetch(filePath);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const buffer = await response.arrayBuffer();
            return new TextDecoder().decode(buffer).split('\r\n');
        }

        // loadPokemonNames('./assets/dat/pokemon.txt').then(pokemonNames => {
        //     console.log('Pokemon names loaded:', pokemonNames);
        // }).catch(error => {
        //     console.error('Error loading Pokemon names:', error);
        // });

        loadDAT('./assets/dat/DiamondSlots.dat').then(dat => {
            console.log('DAT loaded:', dat);
        }).catch(error => {
            console.error('Error loading DAT:', error);
        });

    </script>
</body>
</html>